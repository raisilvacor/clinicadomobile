{% extends "admin/base.html" %}

{% block title %}Configura√ß√£o NFS-e{% endblock %}

{% block content %}
<div class="admin-card">
    <h2>‚öôÔ∏è Configura√ß√£o NFS-e</h2>
    <p>Configure as credenciais e dados necess√°rios para emiss√£o de Notas Fiscais de Servi√ßo Eletr√¥nicas.</p>
    
    <div style="background: rgba(255, 140, 0, 0.1); border: 2px solid #ff8c00; border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
        <h3 style="color: #ff8c00; margin-bottom: 1rem;">üìö Informa√ß√µes Importantes</h3>
        <ul style="color: #ffffff; line-height: 1.8;">
            <li>Para emitir NFS-e, voc√™ precisa de uma conta em um provedor de API (Nuvem Fiscal ou DevNotas)</li>
            <li>Recomendamos come√ßar com o ambiente de <strong>Homologa√ß√£o</strong> para testes</li>
            <li>Ap√≥s testar, altere para <strong>Produ√ß√£o</strong> para emitir notas reais</li>
            <li>Links √∫teis:
                <ul style="margin-top: 0.5rem;">
                    <li><a href="https://dev.nuvemfiscal.com.br/docs" target="_blank" style="color: #ff8c00;">Nuvem Fiscal - Documenta√ß√£o</a></li>
                    <li><a href="https://dev.devnotas.com.br" target="_blank" style="color: #ff8c00;">DevNotas - Documenta√ß√£o</a></li>
                    <li><a href="https://www.nfse.gov.br" target="_blank" style="color: #ff8c00;">Portal NFS-e Oficial</a></li>
                </ul>
            </li>
        </ul>
    </div>
    
    <form method="POST" action="{{ url_for('admin_nfse_config') }}">
        <div class="admin-card" style="background: #0d0d0d;">
            <h3 style="color: #ff8c00; margin-bottom: 1.5rem;">üîê Credenciais da API</h3>
            
            <div class="form-group">
                <label>Provedor de API <span style="color: #ff8c00;">*</span></label>
                <select name="provider" required style="width: 100%;">
                    <option value="nuvemfiscal" {% if nfse_config.get('provider') == 'nuvemfiscal' %}selected{% endif %}>Nuvem Fiscal</option>
                    <option value="devnotas" {% if nfse_config.get('provider') == 'devnotas' %}selected{% endif %}>DevNotas</option>
                </select>
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    Escolha o provedor de API que voc√™ possui conta
                </small>
            </div>
            
            <div class="form-group">
                <label>Client ID <span style="color: #ff8c00;">*</span></label>
                <input type="text" name="client_id" value="{{ nfse_config.get('client_id', '') }}" required placeholder="Seu Client ID">
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    Client ID obtido no painel da Nuvem Fiscal (ex: Fh0oefK6gWpnkqA21Ydm)
                </small>
            </div>
            
            <div class="form-group">
                <label>Client Secret <span style="color: #ff8c00;">*</span></label>
                <input type="password" name="client_secret" value="{{ nfse_config.get('client_secret', '') }}" required placeholder="Seu Client Secret">
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    Client Secret obtido no painel da Nuvem Fiscal (copie e salve com seguran√ßa)
                </small>
            </div>
            
            <div class="form-group">
                <label>Ambiente</label>
                <select name="ambiente" style="width: 100%;">
                    <option value="homologacao" {% if nfse_config.get('ambiente') != 'producao' %}selected{% endif %}>Homologa√ß√£o (Testes)</option>
                    <option value="producao" {% if nfse_config.get('ambiente') == 'producao' %}selected{% endif %}>Produ√ß√£o (Real)</option>
                </select>
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    Use Homologa√ß√£o para testes, Produ√ß√£o para notas reais
                </small>
            </div>
        </div>
        
        <div class="admin-card" style="background: #0d0d0d; margin-top: 2rem;">
            <h3 style="color: #ff8c00; margin-bottom: 1.5rem;">üè¢ Dados do Prestador</h3>
            
            <div class="form-group">
                <label>CNPJ <span style="color: #ff8c00;">*</span></label>
                <input type="text" name="cnpj" value="{{ nfse_config.get('cnpj', '') }}" required placeholder="00000000000100" maxlength="14">
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    CNPJ da empresa (apenas n√∫meros)
                </small>
            </div>
            
            <div class="form-group">
                <label>Inscri√ß√£o Municipal <span style="color: #ff8c00;">*</span></label>
                <input type="text" name="inscricao_municipal" value="{{ nfse_config.get('inscricao_municipal', '') }}" required placeholder="Inscri√ß√£o Municipal">
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    Inscri√ß√£o Municipal da empresa
                </small>
            </div>
        </div>
        
        <div class="admin-card" style="background: #0d0d0d; margin-top: 2rem;">
            <h3 style="color: #ff8c00; margin-bottom: 1.5rem;">üíº Dados do Servi√ßo</h3>
            
            <div class="form-group">
                <label>C√≥digo do Servi√ßo (LC 116/2003)</label>
                <input type="text" name="codigo_servico" value="{{ nfse_config.get('codigo_servico', '1407') }}" placeholder="1407">
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    C√≥digo padr√£o: 1407 (Assist√™ncia T√©cnica). Consulte a lista completa em <a href="https://www.nfse.gov.br" target="_blank" style="color: #ff8c00;">nfse.gov.br</a>
                </small>
            </div>
            
            <div class="form-group">
                <label>Al√≠quota do ISS (%)</label>
                <input type="number" name="aliquota_iss" value="{{ nfse_config.get('aliquota_iss', '5.0') }}" step="0.01" min="0" max="100" placeholder="5.0">
                <small style="color: #999; display: block; margin-top: 0.5rem;">
                    Al√≠quota do Imposto Sobre Servi√ßos do seu munic√≠pio
                </small>
            </div>
        </div>
        
        <div style="margin-top: 2rem;">
            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                üíæ Salvar Configura√ß√µes
            </button>
        </div>
    </form>
</div>

<script>
// M√°scara CNPJ
document.querySelector('input[name="cnpj"]')?.addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/\D/g, '');
});
</script>
{% endblock %}

